<!-- run_results.html -->
{% extends "base.html" %}
{% block title %}Run Results - {{ problem.title }}{% endblock %}

{% block extra_head %}
  <!-- highlight.js CSS (theme) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
  <style>
    .code-toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: .5rem 0 .25rem;
      gap: .5rem;
    }
    .copy-btn {
      padding: .35rem .6rem;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: .85rem;
      cursor: pointer;
      background: #fff;
    }
    .verdict.accepted { color: #1a7f37; }
    .verdict.rejected { color: #d1242f; }
  </style>
{% endblock %}

{% block content %}
<div class="card">
  <h2>🔍 Code Run Results</h2>

  <div class="mb-2">
    <p><strong>Problem:</strong> <a href="{% url 'problem_detail' problem.id %}">{{ problem.title }}</a></p>
    <p><strong>Language:</strong> {{ language }}</p>
    <p><strong>Verdict:</strong>
      <span class="verdict {% if verdict == 'Accepted' %}accepted{% else %}rejected{% endif %}">
        {% if verdict == 'Accepted' %}✅{% else %}❌{% endif %} {{ verdict }}
      </span>
    </p>
  </div>

  <h3>💻 Your Code:</h3>

  <!-- optional small toolbar above the code -->
  <div class="code-toolbar">
    <span></span>
    <button id="copy-code" class="copy-btn" type="button">📋 Copy</button>
  </div>

  <!-- Read-only code with highlight.js; escape to prevent XSS, preserve newlines -->
  <div class="code-block">
    <pre><code id="user-code"
      class="language-{{ language|lower|default:'plaintext' }}">{{ code|default_if_none:""|escape }}</code></pre>
  </div>

  <h3>🧪 Sample Test Case Results:</h3>
  {% if results %}
    <div class="styled-table">
      <table class="test-results-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Input</th>
            <th>Expected Output</th>
            <th>Your Output</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          {% for r in results %}
            <tr class="{% if r.passed %}passed{% else %}failed{% endif %}">
              <td>{{ forloop.counter }}</td>
              <td><pre>{{ r.test_case.input_data }}</pre></td>
              <td><pre>{{ r.test_case.output_data }}</pre></td>
              <td><pre>{{ r.user_output }}</pre></td>
              <td>{% if r.passed %}✅ Passed{% else %}❌ Failed{% endif %}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p>🔍 No sample tests found for this problem.</p>
  {% endif %}

  <div class="mt-3">
    <a class="bt
