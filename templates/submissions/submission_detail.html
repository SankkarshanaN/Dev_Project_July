<!-- submission_detail.html -->
{% extends "base.html" %}
{% block title %}Submission #{{ submission.id }} - CodeFun{% endblock %}

{% block extra_head %}
<style>
  .action-buttons {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
  }
  .btn {
    padding: .5rem 1rem;
    text-decoration: none;
    border-radius: 6px;
    border: 1px solid #ddd;
    background: #fff;
    color: #333;
    transition: all 0.2s;
  }
  .btn:hover {
    background: #f0f0f0;
    text-decoration: none;
  }
  .btn-primary {
    background: #007bff;
    border-color: #007bff;
    color: white;
  }
  .btn-primary:hover {
    background: #0056b3;
    border-color: #0056b3;
    color: white;
  }
  .btn-secondary {
    background: #6c757d;
    border-color: #6c757d;
    color: white;
  }
  .btn-secondary:hover {
    background: #545b62;
    border-color: #545b62;
    color: white;
  }
</style>
{% endblock %}

{% block content %}
<div class="card">
    <h2>📋 Submission #{{ submission.id }}</h2>
    <div class="mb-2">
        <p><strong>Problem:</strong> 
            <a href="{% url 'problem_detail' submission.problem.id %}">
                {{ submission.problem.title }}
            </a>
        </p>
        <p><strong>Language:</strong> {{ submission.language }}</p>
        <p><strong>Status:</strong> 
            <span class="status {% if submission.result == 'Accepted' %}accepted{% else %}rejected{% endif %}">
                {% if submission.result == 'Accepted' %}✅{% else %}❌{% endif %} {{ submission.result }}
            </span>
        </p>
        <p><strong>Submitted:</strong> {{ submission.submitted_at|date:"M d, Y H:i" }}</p>
    </div>

    <h3>💻 Your Code:</h3>
    <div class="code-block">
        <pre><code class="language-{{ submission.language|lower }}">{{ submission.code }}</code></pre>
    </div>

    {% if submission.error %}
        <h3>⚠️ Error Message:</h3>
        <div class="error-block"><pre>{{ submission.error }}</pre></div>
    {% endif %}

    <h3>🧪 Test Case Results (Sample Only):</h3>
    {% if results %}
        <div class="styled-table">
            <table class="test-results-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Input</th>
                        <th>Expected Output</th>
                        <th>Your Output</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for r in results %}
                        {% if r.test_case.is_sample %}
                        <tr class="{% if r.passed %}passed{% else %}failed{% endif %}">
                            <td>{{ forloop.counter }}</td>
                            <td><pre>{{ r.test_case.input_data }}</pre></td>
                            <td><pre>{{ r.test_case.output_data }}</pre></td>
                            <td><pre>{{ r.user_output }}</pre></td>
                            <td>
                                {% if r.passed %}✅ Passed{% else %}❌ Failed{% endif %}
                            </td>
                        </tr>
                        {% endif %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p>🔍 No test case results found.</p>
    {% endif %}

    <div class="mt-3">
      <div class="action-buttons">
        <a href="{% url 'problem_detail' submission.problem.id %}" class="btn btn-primary">
          🔙 Back to Problem
        </a>
        {% if submission.result == 'Accepted' %}
          <a href="{% url 'problem_list' %}" class="btn btn-secondary">
            📝 Try Another Problem
          </a>
        {% endif %}
      </div>
    </div>
</div>

<!-- Highlight.js -->
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script>hljs.highlightAll();</script>
{% endblock %}
